<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>Introduction to clj-foundation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Clj-foundation</span> <span class="project-version">0.9.23</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Topics</span></h3><ul><li class="depth-1  current"><a href="intro.html"><div class="inner"><span>Introduction to clj-foundation</span></div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>clj-foundation</span></div></div></li><li class="depth-2 branch"><a href="clj-foundation.caller.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>caller</span></div></a></li><li class="depth-2 branch"><a href="clj-foundation.config.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>config</span></div></a></li><li class="depth-2 branch"><a href="clj-foundation.conversions.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>conversions</span></div></a></li><li class="depth-2 branch"><a href="clj-foundation.data.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>data</span></div></a></li><li class="depth-2 branch"><a href="clj-foundation.errors.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>errors</span></div></a></li><li class="depth-2 branch"><a href="clj-foundation.grep.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>grep</span></div></a></li><li class="depth-2 branch"><a href="clj-foundation.io.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>io</span></div></a></li><li class="depth-2 branch"><a href="clj-foundation.math.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>math</span></div></a></li><li class="depth-2 branch"><a href="clj-foundation.millis.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>millis</span></div></a></li><li class="depth-2 branch"><a href="clj-foundation.oo.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>oo</span></div></a></li><li class="depth-2 branch"><a href="clj-foundation.patterns.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>patterns</span></div></a></li><li class="depth-2 branch"><a href="clj-foundation.pipe.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pipe</span></div></a></li><li class="depth-2 branch"><a href="clj-foundation.templates.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>templates</span></div></a></li><li class="depth-2 branch"><a href="clj-foundation.transducers.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>transducers</span></div></a></li><li class="depth-2 branch"><a href="clj-foundation.tree-visit.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>tree-visit</span></div></a></li><li class="depth-2"><a href="clj-foundation.unit-test-common.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>unit-test-common</span></div></a></li></ul></div><div class="document" id="content"><div class="doc"><div class="markdown"><h1><a href="#introduction-to-clj-foundation" name="introduction-to-clj-foundation"></a>Introduction to clj-foundation</h1>
<p>Clojure has a great standard library. Even so, some things could be easier than they are.</p>
<h2><a href="#why-clj-foundation-" name="why-clj-foundation-"></a>Why clj-foundation?</h2>
<p>clj-foundation supplies namespaces making additional simple things easy and hard things possible in Clojure for functions needed across all Clojure projects at Brad’s Deals.</p>
<p>The following describe our core goals/values for clj-foundation:</p>
<ul>
  <li>Enhances the core language in resonable, useful, and conservative ways.</li>
  <li>Not a framework. Rather, a conservative set of generally-useful functions that may be used together or separately.</li>
  <li>Makes it easy to create new transducers (or pipelines of transducers) from any regular function.</li>
  <li>Where applicable, enables programming using a monadic style without requiring explicit monad types.</li>
  <li>Clojure already polymorphically supports mapcat over most core data types. The missing thing is an implementation of the monadic zero as a separate and distinct thing from nil.</li>
  <li>Describes, specifies, and illustrates best practices at Brad’s Deals for working in Clojure.</li>
  <li>The only dependencies are Clojure.*, Potemkin, io.aviso/pretty (for better stack traces), and Schema in order to minimize adoption friction. In the near future we will migrate from Schema to Specs.</li>
</ul>
<h2><a href="#other-clojure-foundational-libraries-that-compliment-this-one" name="other-clojure-foundational-libraries-that-compliment-this-one"></a>Other Clojure foundational libraries that compliment this one</h2>
<ul>
  <li>Immutant: <a href="http://immutant.org/">http://immutant.org/</a></li>
  <li>Hara: <a href="http://docs.caudate.me/hara/index.html">http://docs.caudate.me/hara/index.html</a></li>
</ul>
<h2><a href="#high-quality-domain-specific-libraries-complimenting-this" name="high-quality-domain-specific-libraries-complimenting-this"></a>High-quality domain-specific libraries complimenting this</h2>
<ul>
  <li>Cassandra as a mutable, versioned map: <a href="https://github.com/MyPost/cassius">https://github.com/MyPost/cassius</a></li>
  <li>Git from the Clojure REPL: <a href="https://github.com/zcaudate/gita">https://github.com/zcaudate/gita</a></li>
</ul>
<h2><a href="#curated-directories-of-clojure-libraries" name="curated-directories-of-clojure-libraries"></a>Curated directories of Clojure libraries</h2>
<ul>
  <li><a href="http://clojurewerkz.org">http://clojurewerkz.org</a></li>
  <li><a href="http://blog.takipi.com/the-top-100-clojure-libraries-in-2016-after-analyzing-30000-dependencies/">http://blog.takipi.com/the-top-100-clojure-libraries-in-2016-after-analyzing-30000-dependencies/</a></li>
  <li><a href="https://github.com/razum2um/awesome-clojure">https://github.com/razum2um/awesome-clojure</a></li>
  <li><a href="http://www.clojure-toolbox.com/">http://www.clojure-toolbox.com/</a></li>
</ul>
<h1><a href="#features" name="features"></a>Features</h1>
<p>The folowing is a small sample of clj-foundation’s features:</p>
<h2><a href="#math" name="math"></a>Math</h2>
<ul>
  <li>A Mixed Number type</li>
  <li>Time conversions to/from milliseconds</li>
  <li>(str (millis/-&gt;dmhs elapsed-time)) =&gt; e.g.: “5 days 2 hours 3 minutes 2 seconds”</li>
  <li>A Nothing type that behaves like the identity value for Maps, Seqs, and Strings and is distinct from nil.</li>
  <li>Functions converting identity values of various types/operations to and from nil.</li>
</ul>
<h2><a href="#ever-had-to-declare-a-map-containing-the-result-of-let-variable-bindings-now-you-can-do-that-in-one-step-with-let-map-" name="ever-had-to-declare-a-map-containing-the-result-of-let-variable-bindings-now-you-can-do-that-in-one-step-with-let-map-"></a>Ever had to declare a map containing the result of let variable bindings? Now you can do that in one step with let-map.</h2>
<pre><code class="clojure">(let-map [meaning 42
          secrets (io/read-file "/etc/passwd")])
==&gt;
{:meaning 42
 :secrets "nobody:*:-2:-2:Unprivileged User:/var/empty:/usr/bin/false\nroot:*:0:0:System Administrator:/var/root:/bin/sh\n...."}
</code></pre>
<h2><a href="#data-error-processing-enhancements-and-timeout-handling-" name="data-error-processing-enhancements-and-timeout-handling-"></a>Data/error processing enhancements and timeout handling.</h2>
<pre><code class="clojure">;; Replace a nil value with a default
(replace-nil (:first-name customer) "John")

;; Returns value if non-nil else throws IllegalArgumentException naming the nil value
(not-nil (:first-name customer) "First name")

;; Expect a condition specified by a predicate to become true within timeout-millis.
;; Throws IllegalStateException on failure with the specified message.
(expect-within
  (millis/&lt;-seconds 5)
  (fn [] (= (meaning-of-life) 42))
  "Couldn't compute the meaning of life.")

;; Retry x times, with millis puase interval a specified function that is failure-prone
(retry 5 (millis/&lt;-seconds 10) some-unreliable-io-operation)
</code></pre>
<h2><a href="#a-string-interpolation-language-that-is-intentionally-dumb-about-the-syntax-of-its-hosting-language-" name="a-string-interpolation-language-that-is-intentionally-dumb-about-the-syntax-of-its-hosting-language-"></a>A string interpolation language that is intentionally dumb about the syntax of its hosting language.</h2>
<pre><code class="clojure">;; Given:
(def content "Say hello to ${NAME}")

;; Then:
(templates/subst&lt;- content :NAME "Jack")
==&gt;
"Say hello to Jack"

(subst&lt;- content :ZIP "46989")
==&gt;
ExceptionInfo Not found: '${NAME}'  clojure.core/ex-info

(interpolation-vars content)
==&gt;
(:NAME)
</code></pre>
<ul>
  <li>Interpolation variables are resolved from the following places with the following precedence:
    <ul>
      <li>Java system variables (e.g.: java -DNAME=‘Jack’ com.foo.bar.YourMainProgram)</li>
      <li>Operating system environment variables</li>
      <li>Any key/value variables specified in code.</li>
    </ul>
  </li>
</ul>
<h2><a href="#extensions-to-clojures-file-input-functions" name="extensions-to-clojures-file-input-functions"></a>Extensions to Clojure’s file input functions</h2>
<pre><code class="clojure">;; Return a Jar resource as a string
(resource-as-string "config.txt")

;; Return a Jar resource as a string, but allow the ALT_CONFIG_LOCATION Java system or O/S environment
;; variable to redirect reading to an external configuration file instead.
(resource-as-string "ALT_CONFIG_LOCATION" "config.txt")

;; Return a Jar resource as a string, interpolating any template variables inside the Jar resource
;; using the supplied interpolation variables and the override rules defined by the template language.
(read-template "config.properties" :NAME "Jack")

;; Return a Jar resource as a string, possibly overridden by the environment variable ALT_CONFIG_LOCATION
;; per the template engine's precedence rules.  Any template variables in the file will also be substuted
;; using the supplied key/value pairs and/or matching environment variables per the template engine's
;; precedence rules.
(read-template "ALT_CONFIG_LOCATION" "config.properties" :NAME "Jack")
</code></pre>
<h2><a href="#and-more" name="and-more"></a>And more…</h2>
<ul>
  <li>Easier serialization / deserialization in various formats. Currently supports binary and EDN formats. Optionally can use the template language to support substitution variables inside EDN files.</li>
  <li>A let-map form similar to “let” that returns its names and values as a Map–for those times the values of subsequent keys in a Map depend on the values of prior ones.</li>
  <li>Simple named implementations of design patterns familiar to Java developers, particularaly Singleton.</li>
</ul>
<h1><a href="#deployment-usage" name="deployment-usage"></a>Deployment/usage</h1>
<h2><a href="#leiningen-coordinates" name="leiningen-coordinates"></a>Leiningen coordinates</h2>
<pre><code class="clojure">:user {:repositories [["jitpack" "https://jitpack.io"]]

       :dependencies [[com.github.shopsmart/clj-foundation "version"]]}
</code></pre>
<p>where “version” currently is “<a href="https://jitpack.io/#shopsmart/clj-foundation"><img src="http://jitpack.io/v/com.github.shopsmart/clj-foundation.svg" alt="Release" /></a>”.</p>
<h2><a href="#maven-coordinates" name="maven-coordinates"></a>Maven coordinates</h2>
<pre><code class="xml">&lt;repositories&gt;
  &lt;repository&gt;
    &lt;id&gt;jitpack.io&lt;/id&gt;
    &lt;name&gt;Jitpack repo&lt;/name&gt;
    &lt;url&gt;https://jitpack.io&lt;/url&gt;
  &lt;/repository&gt;
&lt;/repositories&gt;
</code></pre>
<ul>
  <li>GroupId: com.github.shopsmart</li>
  <li>ArtifactId: clj-foundation</li>
  <li>Version: <a href="https://jitpack.io/#shopsmart/clj-foundation"><img src="http://jitpack.io/v/com.github.shopsmart/clj-foundation.svg" alt="Release" /></a></li>
</ul>
<h2><a href="#manual-build-test" name="manual-build-test"></a>Manual build/test</h2>
<pre><code class="bash"># Build
$ lein jar

# Test
$ lein with-profile test test
</code></pre></div></div></div></body></html>